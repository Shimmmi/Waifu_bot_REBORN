# Анализ: как работают СОБЫТИЯ в групповом подземелье

## Пример сообщения в чате

```
⚡️ СОБЫТИЕ: Щит

Требование: 1+ игроков с 🛡️/🔰/⛑️ за 45 сек
⏳ Осталось: 45 сек
👥 Выполнили: 0/1 игроков
```

## Что это значит

1. **Событие** — механика, которая срабатывает в определённый момент боя (например, когда у монстра остаётся 50% или 10% HP, или на боссе — уникальное событие по теме подземелья).

2. **Требование** — что должны сделать игроки:
   - **«1+ игроков»** — минимум один человек (или больше, если указано 5/8 и т.д.) должен выполнить условие.
   - **«с 🛡️/🔰/⛑️»** — в своём сообщении в чат нужно отправить **один из этих эмодзи** (или стикер; для событий с эмодзи стикер тоже засчитывается).
   - **«за 45 сек»** — время ограничено: если нужное число игроков не успеет отправить подходящее сообщение, событие «сгорает».

3. **⏳ Осталось** — обратный отсчёт до конца события.

4. **👥 Выполнили: 0/1** — сколько **разных** игроков уже отправили подходящее сообщение. Когда счётчик дойдёт до требуемого (например 1/1 или 5/5), событие считается выполненным.

## Как выполнить событие

- Написать в групповой чат **любое сообщение**, в котором есть **нужный эмодзи** (или отправить стикер).
- Примеры для **«Щит»** (🛡️/🔰/⛑️): сообщение «🛡️ держим!», «🔰» или стикер со щитом.
- Каждый **новый** игрок, отправивший подходящее сообщение, увеличивает счётчик «Выполнили». Один и тот же игрок дважды не засчитывается.

## Типы событий

| Тип срабатывания | Когда появляется | Примеры | Эффект при выполнении |
|------------------|------------------|----------|------------------------|
| **hp_50**        | У монстра ≤50% HP | Щит, Исцеление, Финальный рывок | Событие засчитывается (логика эффектов shield/heal в разработке) |
| **hp_10**        | У монстра ≤10% HP | Те же шаблоны | Аналогично |
| **boss_unique**  | На боссе (по теме подземелья) | Вихрь, Прилив, Оазис, Отражение, Замедление | −25% HP босса |

## Маппинг «тип → эмодзи» в коде

В `group_dungeon.py` задан словарь `EMOJI_FILTER_TO_EMOJIS`:

- **shield** → 🛡️ 🔰 ⛑️ 🛡 🔒 (событие «Щит»)
- **heal** → 💚 ❤️ 💗 ✨ 🩹 💕 (событие «Исцеление»)
- **fire** → 🔥 💥 ⚡ ✨
- **wind** → ✈️ 🌪️ 💨 🌬️ 🌀 (событие «Вихрь»)
- **water** → 💧 🌊 🐚 🐟 🐙 (событие «Прилив»)
- **sun** → ☀️ 🌞 🔥 ✨ 🌟 (событие «Оазис»)
- **mirror** → 🪞 ✨ 💫 👁️ (событие «Отражение»)

В сообщении события в чате теперь подставляются **реальные эмодзи** (например «🛡️/🔰/⛑️» вместо слова «shield»), чтобы игрокам было понятно, что писать.

## Итог

- **«1+ игроков с shield»** в старом виде означало то же самое, но без подсказки эмодзи; теперь показывается **«1+ игроков с 🛡️/🔰/⛑️ за 45 сек»**.
- Чтобы **выполнить** событие «Щит», достаточно, чтобы **хотя бы один игрок** отправил в чат сообщение с одним из этих эмодзи (или стикер) в течение 45 секунд.
- После выполнения счётчик обновится (1/1), в сообщении появится «✅ Событие выполнено!», исходное сообщение события можно редактировать/оставлять по текущей логике бота.
